---
import "./services.css";
import Pill from "../../ui/Pill/Pill.astro";
import ServiceConsole from "./ServiceConsole.tsx";

/** Astro-safe SVG strings (set:html). */
const ICONS = {
  build: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 17l6-6 4 4 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 20H4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  scheduling: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M7 3v3M17 3v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M4 8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M6 6h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V8a2 2 0 012-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M8 12h4M8 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  wallet: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M17 12h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M7 9h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  inbox: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 5h16l-2 7h-4l-2 2h-4l-2-2H6L4 5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M4 12v7h16v-7" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
    </svg>
  `,
  gifts: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M20 12v8a2 2 0 01-2 2H6a2 2 0 01-2-2v-8" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M4 8h16v4H4V8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M12 8v14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M12 8c-2.5 0-4-1-4-2.5S9 3 10.5 3C12 3 12 5 12 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 8c2.5 0 4-1 4-2.5S15 3 13.5 3C12 3 12 5 12 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  `,
  reminders: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 22a2 2 0 002-2H10a2 2 0 002 2z" fill="currentColor" opacity=".55"></path>
      <path d="M18 16v-5a6 6 0 10-12 0v5l-2 2h16l-2-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
    </svg>
  `,
};

const cards = [
  {
    key: "build",
    tone: "violet",
    media: "customization",
    mosaic: "leftTall",
    tag: "Build",
    title: "Astro performance build",
    desc: "Static-first speed with a studio finish. Clean code, fast loads, strong fundamentals.",
    meta: "Best for: full sites",
    bullets: ["Core Web Vitals-ready", "SEO hygiene baked in"],
  },
  {
    key: "scheduling",
    tone: "rose",
    media: "scheduling",
    mosaic: "topWide",
    tag: "Conversion",
    title: "Landing pages that convert",
    desc: "Message clarity + flow. Designed to turn browsers into enquiries — without shouting.",
    meta: "Best for: ads & promos",
  },
  {
    key: "wallet",
    tone: "mint",
    media: "wallet",
    mosaic: "midLeft",
    tag: "Clarity",
    title: "Copy & structure",
    desc: "We shape the words and hierarchy so your offer lands instantly.",
    meta: "Best for: fuzzy offers",
  },
  {
    key: "inbox",
    tone: "amber",
    media: "inbox",
    mosaic: "midRight",
    tag: "SEO",
    title: "Local SEO foundations",
    desc: "Structure, schema, on-page hygiene. Built to rank for intent — not vanity.",
    meta: "Best for: UK locals",
  },
  {
    key: "gifts",
    tone: "sunset",
    media: "gifts",
    mosaic: "bottomWide",
    tag: "Signals",
    title: "Tracking & analytics",
    desc: "Events that matter. Know what converts — and what just looks pretty.",
    meta: "Best for: decisions",
  },
  {
    key: "reminders",
    tone: "sky",
    media: "reminders",
    mosaic: "bottomRight",
    tag: "Support",
    title: "Care plan",
    desc: "Updates, fixes, small improvements. Keep it sharp after launch.",
    meta: "Best for: peace of mind",
  },
];
---

<section id="services" class="k-services k-services--appTiles" aria-labelledby="services-title" data-services>
  <div class="container k-services__inner">
    <!-- Header -->
    <header class="k-svcHead">
      <div class="k-svcHead__kicker">SERVICES</div>

      <h2 class="k-svcHead__title" id="services-title">
        Six modules. One clean system.
        <span class="k-svcHead__grad">Built to convert.</span>
      </h2>

      <p class="k-svcHead__lead">
        Clear scope, clean build, and a site that’s ready to earn — without fluffy promises.
      </p>
    </header>

    <!-- Mobile: Service Console -->
    <div class="k-svcConsoleWrap" aria-label="Services console">
      <ServiceConsole client:visible cards={cards} />
    </div>

    <!-- Desktop / tablet: mosaic tiles -->
    <div class="k-tiles" role="list" aria-label="Kersivo services">
      {cards.map((c) => {
        const cls = [
          "k-tile",
          `k-tile--tone-${c.tone}`,
          `k-tile--mosaic-${c.mosaic}`,
          c.href ? "k-tile--link" : "",
        ].filter(Boolean).join(" ");

        const Inner = (
          <>
            <span class="k-tile__bg" aria-hidden="true"></span>
            <span class="k-tile__paper" aria-hidden="true"></span>

            <div class="k-tile__top">
              <div class="k-tile__topLeft">
                <span class="k-tile__icon" aria-hidden="true" set:html={ICONS[c.key]} />
                <Pill label={c.tag} />
              </div>
            </div>

            <div class={["k-tile__media", `k-tile__media--${c.media}`].join(" ")} aria-hidden="true">
              <div class="k-m__a"></div>
              <div class="k-m__b"></div>
              <div class="k-m__c"></div>
              <div class="k-m__d"></div>
              <div class="k-m__e"></div>
            </div>

            <div class="k-tile__content">
              <h3 class="k-tile__title">{c.title}</h3>
              <p class="k-tile__desc">{c.desc}</p>

              {c.bullets?.length ? (
                <ul class="k-tile__bullets" aria-label="Highlights">
                  {c.bullets.map((b) => <li>{b}</li>)}
                </ul>
              ) : null}
            </div>

            <div class="k-tile__foot">
              <span class="k-tile__meta">{c.meta}</span>
            </div>
          </>
        );

        return c.href ? (
          <a class={cls} href={c.href} role="listitem" data-svc-tile>
            {Inner}
          </a>
        ) : (
          <div class={cls} role="listitem" data-svc-tile>
            {Inner}
          </div>
        );
      })}
    </div>
  </div>

  <!-- reveal animation for desktop tiles only -->
  <script>
    (() => {
      const root = document.querySelector("[data-services]");
      if (!root) return;

      const reduced =
        window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const tiles = Array.from(root.querySelectorAll("[data-svc-tile]"));
      if (!tiles.length) return;

      if (reduced) {
        tiles.forEach((el) => el.classList.add("is-in"));
        return;
      }

      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (!e.isIntersecting) return;
            e.target.classList.add("is-in");
            io.unobserve(e.target);
          });
        },
        { threshold: 0.2, rootMargin: "120px 0px" }
      );

      tiles.forEach((el) => io.observe(el));
    })();
  </script>
</section>
