---
import "./services.css";
import Pill from "../../ui/Pill/Pill.astro";
import ServiceMap from "./ServiceMap.tsx";

// If you pass asPage=true on /services page, it will use h1
const { asPage = false } = Astro.props;
const TitleTag = asPage ? "h1" : "h2";

/** Astro-safe SVG strings (set:html). */
const ICONS = {
  build: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 17l6-6 4 4 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 20H4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  scheduling: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M7 3v3M17 3v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M4 8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M6 6h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V8a2 2 0 012-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M8 12h4M8 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  wallet: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M17 12h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M7 9h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  inbox: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 5h16l-2 7h-4l-2 2h-4l-2-2H6L4 5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M4 12v7h16v-7" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
    </svg>
  `,
  gifts: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M20 12v8a2 2 0 01-2 2H6a2 2 0 01-2-2v-8" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M4 8h16v4H4V8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M12 8v14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M12 8c-2.5 0-4-1-4-2.5S9 3 10.5 3C12 3 12 5 12 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 8c2.5 0 4-1 4-2.5S15 3 13.5 3C12 3 12 5 12 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  `,
  reminders: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 22a2 2 0 002-2H10a2 2 0 002 2z" fill="currentColor" opacity=".55"></path>
      <path d="M18 16v-5a6 6 0 10-12 0v5l-2 2h16l-2-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
    </svg>
  `,
};

const cards = [
  {
    key: "build",
    tone: "violet",
    media: "customization",
    mosaic: "leftTall",
    tag: "Build",
    title: "Astro performance build",
    desc: "Static-first speed with a studio finish. Clean code, fast loads, strong fundamentals.",
    proof: "Loads fast. Feels premium.",
    meta: "Best for: full sites",
    bullets: ["Core Web Vitals-ready", "SEO hygiene baked in"],
    stats: [{"big": "90+", "small": "Core Web Vitals-ready"}, {"big": "<1s", "small": "Snappy first load"}],
  },
  {
    key: "scheduling",
    tone: "rose",
    media: "scheduling",
    mosaic: "topWide",
    tag: "Conversion",
    title: "Landing pages that convert",
    desc: "Message clarity + flow. Designed to turn browsers into enquiries — without shouting.",
    proof: "Clear CTAs. More enquiries.",
    meta: "Best for: ads & promos",
    bullets: ["Clear offer hierarchy", "CTA flow tuned"],
    stats: [{"big": "+Enquiries", "small": "Clear CTA flow"}, {"big": "Lower bounce", "small": "Less friction"}],
  },
  {
    key: "wallet",
    tone: "mint",
    media: "wallet",
    mosaic: "midLeft",
    tag: "Clarity",
    title: "Copy & structure",
    desc: "Sharper messaging and calmer layout — so people understand you in seconds.",
    proof: "Sharper message. Less friction.",
    meta: "Best for: repositioning",
    bullets: ["Offer clarity", "Structure that scans"],
    stats: [{"big": "1 message", "small": "Sharper offer"}, {"big": "Faster yes", "small": "Cleaner decisions"}],
  },
  {
    key: "inbox",
    tone: "amber",
    media: "inbox",
    mosaic: "midRight",
    tag: "SEO",
    title: "Local SEO foundations",
    desc: "Local ranking basics done properly: pages, metadata, schema, and signals.",
    proof: "Ranks locally. Brings leads.",
    meta: "Best for: service areas",
    bullets: ["Local pages + schema", "Metadata tuned"],
    stats: [{"big": "Local ranks", "small": "Map + pages"}, {"big": "More leads", "small": "Search intent"}],
  },
  {
    key: "gifts",
    tone: "sunset",
    media: "gifts",
    mosaic: "bottomWide",
    tag: "Signals",
    title: "Tracking & analytics",
    desc: "Know what converts: events, funnels, and dashboards that tell the truth.",
    proof: "Track actions that matter.",
    meta: "Best for: growth decisions",
    bullets: ["Events that matter", "Simple reporting"],
    stats: [{"big": "Tracked", "small": "Calls, forms, taps"}, {"big": "Clarity", "small": "What converts"}],
  },
  {
    key: "reminders",
    tone: "sky",
    media: "reminders",
    mosaic: "bottomRight",
    tag: "Support",
    title: "Care plan",
    desc: "Keep things healthy: updates, fixes, and small improvements — handled.",
    proof: "Stay updated. Stay secure.",
    meta: "Best for: busy owners",
    bullets: ["Updates + monitoring", "Quick fixes"],
    stats: [{"big": "Updated", "small": "Secure + monitored"}, {"big": "Fast fixes", "small": "Small changes, handled"}],
  },
];
---

<section class="k-services--appTiles" data-services>
  <div class="k-container">
    <header class="k-svcHead">
      <div class="k-svcHead__kicker">SERVICES</div>
      <TitleTag class="k-svcHead__title">
        Six modules. One clean system.
        <span class="k-svcHead__grad">Built to convert.</span>
      </TitleTag>
      <p class="k-svcHead__lead">
        Clear scope, clean build, and a site that’s ready to earn — without fluffy promises.
      </p>
    </header>

    <!-- Mobile: React map (morph detail view) -->
    <div class="k-svcMapWrap">
      <ServiceMap client:only="react" cards={cards} />
    </div>

    <!-- Desktop / Tablet: Mosaic tiles -->
    <div class="k-tiles" role="list" aria-label="Service modules">
      {cards.map((c) => {
        const cls = [
          "k-tile",
          `k-tile--tone-${c.tone}`,
          `k-tile--mosaic-${c.mosaic}`,
          c.href ? "k-tile--link" : "",
        ]
          .filter(Boolean)
          .join(" ");

        const Inner = (
          <>
            <span class="k-tile__bg" aria-hidden="true"></span>
            <span class="k-tile__paper" aria-hidden="true"></span>

            <div class="k-tile__top">
              <div class="k-tile__topLeft">
                <span class="k-tile__icon" aria-hidden="true" set:html={ICONS[c.key]} />
                <Pill label={c.tag} />
              </div>
            </div>

            <div class={["k-tile__media", `k-tile__media--${c.media}`].join(" ")} aria-hidden="true">
              <div class="k-m__a"></div>
              <div class="k-m__b"></div>
              <div class="k-m__c"></div>
              <div class="k-m__d"></div>
              <div class="k-m__e"></div>
            </div>

            <div class="k-tile__content">
              <h3 class="k-tile__title">{c.title}</h3>
              <p class="k-tile__desc">{c.desc}</p>

              {c.bullets?.length ? (
                <ul class="k-tile__bullets" aria-label="Highlights">
                  {c.bullets.map((b) => (
                    <li>{b}</li>
                  ))}
                </ul>
              ) : null}

              {c.stats?.length ? (
                <div class="k-tile__stats" aria-label="Module stats">
                  <div class="k-tile__stat">
                    <div class="k-tile__statBig">{c.stats[0].big}</div>
                    <div class="k-tile__statSmall">{c.stats[0].small}</div>
                  </div>
                  <div class="k-tile__stat">
                    <div class="k-tile__statBig">{c.stats[1].big}</div>
                    <div class="k-tile__statSmall">{c.stats[1].small}</div>
                  </div>
                </div>
              ) : null}

              {c.proof ? <p class="k-tile__proof">{c.proof}</p> : null}
            </div>

            <div class="k-tile__foot">
              <span class="k-tile__meta">{c.meta}</span>
            </div>
          </>
        );

        return c.href ? (
          <a class={cls} href={c.href} role="listitem" data-svc-tile>
            {Inner}
          </a>
        ) : (
          <div class={cls} role="listitem" data-svc-tile>
            {Inner}
          </div>
        );
      })}
    </div>
  </div>

  <!-- reveal animation for desktop tiles only -->
  <script>
    (() => {
      const root = document.querySelector("[data-services]");
      if (!root) return;

      const reduced =
        window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const tiles = Array.from(root.querySelectorAll("[data-svc-tile]"));
      if (!tiles.length) return;

      if (reduced) {
        tiles.forEach((el) => el.classList.add("is-in"));
        return;
      }

      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (e.isIntersecting) e.target.classList.add("is-in");
          });
        },
        { threshold: 0.18 }
      );

      tiles.forEach((el) => io.observe(el));
    })();
  </script>
</section>
