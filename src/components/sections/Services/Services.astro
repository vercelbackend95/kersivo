---
import "./services.css";
import Pill from "../../ui/Pill/Pill.astro";
import CtaButton from "../../ui/CtaButton/CtaButton.astro";

/**
 * SVG icons as strings (Astro-safe), injected via set:html.
 * Stroke-only, inherits currentColor.
 */
const ICONS: Record<string, string> = {
  build: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 17l6-6 4 4 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 20H4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  landing: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 7h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M4 12h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M4 17h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M18 12l2 2 3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  `,
  seo: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M10.5 14.5l-2 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M11 6a6 6 0 104.2 10.2L20 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  `,
  copy: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M6 7h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M6 12h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M6 17h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  tracking: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M5 19V9" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M12 19V5" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M19 19v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  ui: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M7 9h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M7 13h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
    </svg>
  `,
  care: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 3l7 4v6c0 5-3 8-7 8s-7-3-7-8V7l7-4z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
      <path d="M9 12l2 2 4-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  `,
  cta: `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 12h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
      <path d="M14 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  `,
};

const tiles = [
  {
    size: "xl",
    span: 6,
    tone: "build",
    icon: "build",
    tag: "Build",
    title: "Astro performance build",
    desc: "Static-first speed with a studio finish. Clean code, fast loads, strong fundamentals.",
    meta: "Best for: full sites",
    points: ["Core Web Vitals-ready", "SEO hygiene baked in"],
  },
  {
    size: "md",
    tone: "landing",
    icon: "landing",
    tag: "Conversion",
    title: "Landing pages that convert",
    desc: "Message clarity + flow. Designed to turn browsers into enquiries — without shouting.",
    meta: "Best for: ads & promos",
  },
  {
    size: "md",
    tone: "seo",
    icon: "seo",
    tag: "SEO",
    title: "Local SEO foundations",
    desc: "Structure, schema, on-page hygiene. Built to rank for intent — not vanity.",
    meta: "Best for: UK locals",
  },
  {
    size: "sm",
    tone: "copy",
    icon: "copy",
    tag: "Clarity",
    title: "Copy & structure",
    desc: "We shape the words and hierarchy so your offer lands instantly.",
    meta: "Best for: fuzzy offers",
  },
  {
    size: "sm",
    tone: "tracking",
    icon: "tracking",
    tag: "Signals",
    title: "Tracking & analytics",
    desc: "Events that matter. Know what converts — and what just looks pretty.",
    meta: "Best for: decisions",
  },
  {
    size: "lg",
    span: 8,
    tone: "ui",
    icon: "ui",
    tag: "Design",
    title: "Premium UI system",
    desc: "A tight design language: typography, spacing, components — consistent everywhere.",
    meta: "Best for: brand lift",
    points: ["Typography + spacing system", "Reusable components library"],
  },
  {
    size: "md",
    span: 4,
    tone: "care",
    icon: "care",
    tag: "Support",
    title: "Care plan",
    desc: "Updates, fixes, small improvements. Keep it sharp after launch.",
    meta: "Best for: peace of mind",
    href: "#contact",
  },
];
---

<section id="services" class="k-services" aria-labelledby="services-title" data-services>
  <div class="container k-services__inner">
    <header class="k-services__head">
      <div class="k-services__kicker">
        <h6>Services</h6>
      </div>

      <div class="k-services__copy">
        <h2 id="services-title">A clean set of modules. Built to sell — and stay fast.</h2>
        <p class="measure">
          Packages are just bundles of these building blocks. Pick a package, or we tailor the mix around your
          goal, timeline, and audience.
        </p>
      </div>
    </header>

    <div class="k-services__grid" role="list" aria-label="Kersivo services">
      {tiles.map((t) =>
        t.href ? (
          <a
            class={[
              "k-svcTile",
              `k-svcTile--${t.size}`,
              `k-svcTile--${t.tone}`,
              t.span ? `k-svcTile--span${t.span}` : "",
              "k-svcTile--link",
            ]
              .filter(Boolean)
              .join(" ")}
            href={t.href}
            role="listitem"
            data-svc-tile
          >
            <span class="k-svcTile__bg" aria-hidden="true"></span>
            <span class="k-svcTile__grain" aria-hidden="true"></span>

            <div class="k-svcTile__top">
              <div class="k-svcTile__topLeft">
                <span class="k-svcTile__icon" aria-hidden="true" set:html={ICONS[t.icon]} />
                <Pill label={t.tag} />
              </div>
            </div>

            <div class="k-svcTile__content">
              <h3 class="k-svcTile__title">{t.title}</h3>
              <p class="k-svcTile__desc">{t.desc}</p>

              {t.points?.length ? (
                <ul class="k-svcTile__bullets" aria-label="Highlights">
                  {t.points.map((p) => <li>{p}</li>)}
                </ul>
              ) : null}
            </div>

            <div class="k-svcTile__foot">
              <span class="k-svcTile__meta">{t.meta}</span>
              <span class="k-svcTile__shine" aria-hidden="true"></span>
            </div>
          </a>
        ) : (
          <div
            class={[
              "k-svcTile",
              `k-svcTile--${t.size}`,
              `k-svcTile--${t.tone}`,
              t.span ? `k-svcTile--span${t.span}` : "",
            ]
              .filter(Boolean)
              .join(" ")}
            role="listitem"
            data-svc-tile
          >
            <span class="k-svcTile__bg" aria-hidden="true"></span>
            <span class="k-svcTile__grain" aria-hidden="true"></span>

            <div class="k-svcTile__top">
              <div class="k-svcTile__topLeft">
                <span class="k-svcTile__icon" aria-hidden="true" set:html={ICONS[t.icon]} />
                <Pill label={t.tag} />
              </div>
            </div>

            <div class="k-svcTile__content">
              <h3 class="k-svcTile__title">{t.title}</h3>
              <p class="k-svcTile__desc">{t.desc}</p>

              {t.points?.length ? (
                <ul class="k-svcTile__bullets" aria-label="Highlights">
                  {t.points.map((p) => <li>{p}</li>)}
                </ul>
              ) : null}
            </div>

            <div class="k-svcTile__foot">
              <span class="k-svcTile__meta">{t.meta}</span>
              <span class="k-svcTile__shine" aria-hidden="true"></span>
            </div>
          </div>
        )
      )}

      <div class="k-svcTile k-svcTile--cta k-svcTile--xl k-svcTile--span12" role="listitem" data-svc-tile>
        <span class="k-svcTile__bg" aria-hidden="true"></span>
        <span class="k-svcTile__grain" aria-hidden="true"></span>

        <div class="k-svcTile__ctaTop">
          <div class="k-svcTile__topLeft">
            <span class="k-svcTile__icon k-svcTile__icon--cta" aria-hidden="true" set:html={ICONS.cta} />
            <h6 class="k-svcTile__ctaKicker">Ready?</h6>
          </div>

          <h3 class="k-svcTile__ctaTitle">Get a quote</h3>
          <p class="k-svcTile__ctaDesc">
            Tell us what you’re building. We’ll reply with a clear plan, timeline, and a fixed quote.
          </p>

          <div class="k-svcTile__ctaMini">
            <span class="k-miniChip">UK small businesses</span>
            <span class="k-miniChip">Fast + SEO-first</span>
            <span class="k-miniChip">No fluff</span>
          </div>
        </div>

        <div class="k-svcTile__ctaBtns">
          <CtaButton href="#contact" label="Get a quote" variant="primary" class="k-svcTile__ctaPrimary" />
          <a class="k-svcTile__ctaGhost" href="#packages">See packages →</a>
        </div>

        <p class="k-svcTile__ctaNote">
          <span class="k-dot" aria-hidden="true"></span>
          Typical reply: within 24 hours (UK time).
        </p>

        <span class="k-svcTile__shine" aria-hidden="true"></span>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const root = document.querySelector("[data-services]");
      if (!root) return;

      const reduced =
        window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const tiles = Array.from(root.querySelectorAll("[data-svc-tile]"));
      if (!tiles.length) return;

      if (reduced) {
        tiles.forEach((el) => el.classList.add("is-in"));
        return;
      }

      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (!e.isIntersecting) return;
            e.target.classList.add("is-in");
            io.unobserve(e.target);
          });
        },
        { threshold: 0.16, rootMargin: "120px 0px" }
      );

      tiles.forEach((el) => io.observe(el));
    })();
  </script>
</section>
